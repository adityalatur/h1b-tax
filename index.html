<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>The H-1B Tax — A Visual Investigation</title>

<!-- Libraries -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://d3js.org/topojson.v3.min.js"></script>
<script src="https://unpkg.com/scrollama"></script>

<style>
/* =====================
   DESIGN SYSTEM
===================== */
:root {
  --bg: #0b0d12;
  --panel: #12151c;
  --text: #eaeaf0;
  --muted: #9aa0b4;
  --accent: #6c8cff;
  --danger: #ff6b6b;
  --success: #4ade80;
  --radius: 16px;
  --ease: cubic-bezier(.4,0,.2,1);
}

@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; }
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: radial-gradient(1200px 800px at 50% -200px, #1b2140 0%, var(--bg) 60%);
  color: var(--text);
  overflow-x: hidden;
}

/* =====================
   INTRO
===================== */
.intro {
  height: 100vh;
  display: grid;
  place-content: center;
  text-align: center;
  padding: 40px;
}

.intro h1 {
  font-size: clamp(2.5rem, 6vw, 4rem);
  font-weight: 900;
  letter-spacing: -0.03em;
}

.intro p {
  font-size: 1.3rem;
  color: var(--muted);
  margin-top: 20px;
}

.scroll-indicator {
  margin-top: 60px;
  font-size: 2rem;
  opacity: 0.6;
  animation: bounce 2s infinite;
}

@keyframes bounce {
  50% { transform: translateY(12px); }
}

/* =====================
   SCROLLYTELLING
===================== */
#scrolly {
  display: flex;
  max-width: 1400px;
  margin: auto;
}

article {
  width: 42%;
  padding-left: 5%;
}

figure {
  width: 50%;
  position: sticky;
  top: 0;
  height: 100vh;
  display: grid;
  place-items: center;
}

.step {
  min-height: 100vh;
  display: flex;
  align-items: center;
}

.step-content {
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border: 1px solid rgba(255,255,255,.12);
  border-radius: var(--radius);
  padding: 40px;
  backdrop-filter: blur(12px);
}

.step-content h2 {
  font-size: 2.2rem;
  color: var(--accent);
  margin-bottom: 16px;
}

.step-content p {
  font-size: 1.1rem;
  line-height: 1.7;
  color: var(--text);
}

.stat {
  display: block;
  font-size: 3rem;
  font-weight: 900;
  color: var(--danger);
  margin: 20px 0;
}

/* =====================
   VISUALS
===================== */
.vis {
  width: 90%;
  height: 90%;
  display: none;
}

.vis.active {
  display: block;
  animation: fade 0.6s var(--ease);
}

@keyframes fade {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* =====================
   RESPONSIVE
===================== */
@media (max-width: 900px) {
  #scrolly { flex-direction: column; }
  article, figure { width: 100%; }
  figure { position: relative; height: 60vh; }
}
</style>
</head>

<body>

<section class="intro">
  <h1>The H-1B Tax</h1>
  <p>You won the lottery. Now pay the hidden bill.</p>
  <div class="scroll-indicator">↓</div>
</section>

<section id="scrolly">

<figure>
  <svg id="vis-lottery" class="vis" width="600" height="400" aria-label="H1B Lottery"></svg>
  <svg id="vis-wage" class="vis" width="600" height="400"></svg>
  <svg id="vis-map" class="vis" width="600" height="420"></svg>
  <svg id="vis-control" class="vis" width="600" height="400"></svg>
  <svg id="vis-clock" class="vis" width="600" height="400"></svg>
  <svg id="vis-gc" class="vis" width="600" height="400"></svg>
  <svg id="vis-total" class="vis" width="600" height="400"></svg>
</figure>

<article>

<div class="step"><div class="step-content">
<h2>The Lottery</h2>
<p>780,000 registrations. Only 85,000 visas.</p>
<span class="stat">11%</span>
<p>Winning is rare. But losing costs even more.</p>
</div></div>

<div class="step"><div class="step-content">
<h2>Salary Suppression</h2>
<span class="stat">$50,950</span>
<p>Annual wage gap between staffing firms and product companies.</p>
</div></div>

<div class="step"><div class="step-content">
<h2>Geographic Trap</h2>
<span class="stat">52%</span>
<p>H-1B jobs are concentrated in just five states.</p>
</div></div>

<div class="step"><div class="step-content">
<h2>Employer Control</h2>
<span class="stat">30.6%</span>
<p>Applications controlled by just 100 companies.</p>
</div></div>

<div class="step"><div class="step-content">
<h2>Layoff Risk</h2>
<span class="stat">60 Days</span>
<p>Lose your job. Lose your status.</p>
</div></div>

<div class="step"><div class="step-content">
<h2>Green Card Backlog</h2>
<span class="stat">20+ Years</span>
<p>For Indian workers — the wait is longer than a career.</p>
</div></div>

<div class="step"><div class="step-content">
<h2>Total Cost</h2>
<span class="stat">$500K+</span>
<p>Lifetime cost of wage loss, mobility loss, and time.</p>
</div></div>

</article>
</section>

<script>
const scroller = scrollama();
const visuals = document.querySelectorAll(".vis");

/* =====================
   VISUAL FUNCTIONS
===================== */

// 1. Lottery
function lottery() {
  const svg = d3.select("#vis-lottery");
  svg.selectAll("*").remove();
  const data = d3.range(100).map(() => Math.random() < 0.11);

  svg.selectAll("rect")
    .data(data)
    .enter()
    .append("rect")
    .attr("x", (d,i)=> (i%10)*55)
    .attr("y", (d,i)=> Math.floor(i/10)*35)
    .attr("width", 40)
    .attr("height", 30)
    .attr("rx", 6)
    .attr("fill", d => d ? "#4ade80" : "#ff6b6b")
    .attr("opacity",0)
    .transition().delay((d,i)=>i*10).attr("opacity",1);
}

// 2. Wage chart
function wage() {
  const svg = d3.select("#vis-wage");
  svg.selectAll("*").remove();

  const data = [
    {label:"Product", value:150000},
    {label:"Staffing", value:99050}
  ];

  const x = d3.scaleBand().domain(data.map(d=>d.label)).range([80,520]).padding(0.4);
  const y = d3.scaleLinear().domain([0,160000]).range([350,50]);

  svg.selectAll("rect")
    .data(data)
    .enter().append("rect")
    .attr("x", d=>x(d.label))
    .attr("y", 350)
    .attr("width", x.bandwidth())
    .attr("height",0)
    .attr("fill", d=>d.label==="Product"? "#4ade80":"#ff6b6b")
    .transition().duration(800)
    .attr("y", d=>y(d.value))
    .attr("height", d=>350-y(d.value));

  svg.append("text")
    .attr("x",300).attr("y",40)
    .attr("text-anchor","middle")
    .attr("fill","#93a5ff")
    .text("~$51K/year wage suppression");
}

// 3. US Map
function map() {
  const svg = d3.select("#vis-map");
  svg.selectAll("*").remove();

  const projection = d3.geoAlbersUsa().translate([300,210]).scale(700);
  const path = d3.geoPath(projection);

  const values = {CA:24.5, TX:11.2, NY:8.3, NJ:4.8, WA:3.2};
  const color = d3.scaleSequential(d3.interpolateBlues).domain([0,25]);

  d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json")
    .then(us=>{
      svg.append("g")
        .selectAll("path")
        .data(topojson.feature(us, us.objects.states).features)
        .join("path")
        .attr("d", path)
        .attr("fill", d=>color(values[d.properties.code]||1))
        .attr("stroke","#111");
    });
}

// Remaining visuals (simple but effective)
function simpleText(id,text){
  const svg=d3.select(id);
  svg.selectAll("*").remove();
  svg.append("text")
    .attr("x",300).attr("y",200)
    .attr("text-anchor","middle")
    .attr("font-size","28px")
    .attr("fill","#ff6b6b")
    .text(text);
}

/* =====================
   SCROLL HANDLER
===================== */
function onStepEnter(r){
  visuals.forEach(v=>v.classList.remove("active"));
  const i = r.index;
  visuals[i].classList.add("active");

  if(i===0) lottery();
  if(i===1) wage();
  if(i===2) map();
  if(i===3) simpleText("#vis-control","Market locked by employers");
  if(i===4) simpleText("#vis-clock","60-Day Countdown");
  if(i===5) simpleText("#vis-gc","Green Card Backlog");
  if(i===6) simpleText("#vis-total","$500,000+ lifetime cost");
}

scroller.setup({ step: ".step", offset: 0.5 }).onStepEnter(onStepEnter);
</script>

</body>
</html>
